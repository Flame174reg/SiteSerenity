(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3698],{3011:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return n}});let r=i(2115);function n(e,t){let i=(0,r.useRef)(null),n=(0,r.useRef)(null);return(0,r.useCallback)(r=>{if(null===r){let e=i.current;e&&(i.current=null,e());let t=n.current;t&&(n.current=null,t())}else e&&(i.current=s(e,r)),t&&(n.current=s(t,r))},[e,t])}function s(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let i=e(t);return"function"==typeof i?i:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},4175:(e,t,i)=>{Promise.resolve().then(i.bind(i,8993))},8993:(e,t,i)=>{"use strict";i.d(t,{default:()=>l});var r=i(5155),n=i(2115),s=i(5239);function a(e){let t=Number.isFinite(Number(e))?Number(e)%5:0;return"https://cdn.discordapp.com/embed/avatars/".concat(t,".png?size=64")}function l(){let[e,t]=(0,n.useState)([]),[i,l]=(0,n.useState)(!0),[c,d]=(0,n.useState)(null),[o,u]=(0,n.useState)(null);async function p(e,i){d(e);try{let r=await fetch("/api/admin/toggle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,admin:i})});if(!r.ok)throw Error("".concat(r.status));t(t=>t.map(t=>t.id===e?{...t,isAdmin:i||t.isOwner||!0===t.isSuperAdmin}:t))}catch(e){alert("Не удалось сохранить роль Админ")}finally{d(null)}}async function h(e,i){d(e);try{let r=await fetch("/api/admin/super/toggle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,super:i})}),n=await r.json().catch(()=>({}));if(!r.ok||!(null==n?void 0:n.ok)){let e=(null==n?void 0:n.error)||r.statusText||"unknown error";throw Error(e)}t(t=>t.map(t=>t.id===e?{...t,isSuperAdmin:i||t.isOwner,isAdmin:i||t.isOwner||t.isAdmin}:t))}catch(e){alert("Не удалось сохранить роль Суперадмин: ".concat(String(e instanceof Error?e.message:e)))}finally{d(null)}}return((0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/admin/users",{cache:"no-store"});if(!e.ok)throw Error("".concat(e.status));let i=((await e.json()).users||[]).map(e=>({...e,isSuperAdmin:e.isOwner})),r=i.map(e=>e.id),n=await fetch("/api/admin/roles",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({ids:r}),cache:"no-store"});if(n.ok){let e=await n.json();if((null==e?void 0:e.ok)&&e.roles)for(let t of i){let i=e.roles[t.id];i&&(t.isSuperAdmin=t.isOwner||i.isSuperAdmin,t.isAdmin=t.isOwner||i.isAdmin)}}t(i)}catch(e){u("Не удалось загрузить список пользователей")}finally{l(!1)}})()},[]),i)?(0,r.jsx)("div",{className:"opacity-70",children:"Загрузка…"}):o?(0,r.jsx)("div",{className:"text-red-400",children:o}):(0,r.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-[auto_1fr_auto_auto_auto] gap-3 text-sm opacity-70 mb-2 px-1",children:[(0,r.jsx)("div",{children:"Пользователь"}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{children:"Последний визит"}),(0,r.jsx)("div",{children:"Админ"}),(0,r.jsx)("div",{children:"Супер"})]}),(0,r.jsx)("ul",{className:"space-y-2",children:e.map(e=>(0,r.jsxs)("li",{className:"grid grid-cols-[auto_1fr_auto_auto_auto] items-center gap-3 rounded-lg px-2 py-2 hover:bg-white/5",children:[(0,r.jsx)("div",{className:"h-8 w-8 overflow-hidden rounded-full bg-white/10",children:(0,r.jsx)(s.default,{src:function(e){var t;let i=(null!=(t=e.avatar)?t:"").trim();if(!i)return a(e.id);try{let e=new URL(i);if("http:"===e.protocol||"https:"===e.protocol)return i}catch(e){}return a(e.id)}(e),alt:e.name||"avatar",width:32,height:32,className:"h-8 w-8 rounded-full object-cover",unoptimized:!0,onError:t=>{t.currentTarget.src=a(e.id)},priority:!0})}),(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("div",{className:"truncate",children:e.name||"Без имени"}),(0,r.jsxs)("div",{className:"text-xs opacity-60 truncate",children:["ID: ",e.id,e.isOwner?" (владелец)":""]})]}),(0,r.jsx)("div",{className:"text-xs opacity-70",children:new Date(e.lastSeen).toLocaleString("ru-RU")}),(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)("input",{type:"checkbox",disabled:e.isOwner||c===e.id,checked:e.isOwner||e.isAdmin||e.isSuperAdmin,onChange:t=>p(e.id,t.target.checked),title:"Админ"})}),(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)("input",{type:"checkbox",disabled:e.isOwner||c===e.id,checked:e.isOwner||!!e.isSuperAdmin,onChange:t=>h(e.id,t.target.checked),title:"Суперадмин"})})]},e.id))}),(0,r.jsx)("p",{className:"text-xs opacity-60 mt-3",children:"Список формируется из тех, кто авторизовался хотя бы один раз."})]})}}},e=>{e.O(0,[5239,8441,1255,7358],()=>e(e.s=4175)),_N_E=e.O()}]);