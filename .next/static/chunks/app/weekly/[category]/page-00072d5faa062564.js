(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6925],{6850:(e,t,a)=>{Promise.resolve().then(a.bind(a,8845))},8845:(e,t,a)=>{"use strict";a.d(t,{default:()=>o});var l=a(5155),n=a(2115);function i(e){return"object"==typeof e&&null!==e}function s(e){let t=i(e)?e:{},a="string"==typeof t.url?t.url:"",l="string"==typeof t.key?t.key:"",n="string"==typeof t.category?t.category:"",s="string"==typeof t.uploadedAt?t.uploadedAt:null;return{url:a,key:l,category:n,uploadedAt:s,size:"number"==typeof t.size?t.size:null===t.size?null:void 0,caption:"string"==typeof t.caption?t.caption:null===t.caption?null:void 0}}function c(e){if(!i(e))return[];let t=e.items;return Array.isArray(t)?t.map(s).filter(e=>""!==e.url&&""!==e.key):[]}function o(e){var t,a;let{safe:s,name:o}=e,[r,u]=(0,n.useState)(null),[d,p]=(0,n.useState)(!0),[h,y]=(0,n.useState)(null),[f,m]=(0,n.useState)(!1),x=(0,n.useMemo)(()=>"/api/weekly/list?safe=".concat(encodeURIComponent(s),"&t=").concat(Date.now()),[s]),g=(0,n.useMemo)(()=>"/api/weekly/list?category=".concat(encodeURIComponent(o),"&t=").concat(Date.now()),[o]);async function w(){p(!0),y(null);try{let e=await fetch(x,{cache:"no-store"}),t=await e.json(),a=c(t);u({ok:!0,items:a})}catch(e){y(String(e))}finally{p(!1)}}function k(e){return i(e)&&"boolean"==typeof e.ok}async function j(e){if(f&&confirm("Удалить это изображение?"))try{let t=await fetch("/api/weekly/photo/delete",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({key:e.key,url:e.url})}),a=await t.json().catch(()=>({}));if(k(a)&&a.ok)await w();else{let e=i(a)&&"string"==typeof a.error?a.error:t.statusText;alert("Не удалось удалить фото: ".concat(e))}}catch(e){alert(String(e))}}async function b(e){var t,a;if(!f)return;let l=null!=(a=window.prompt("Подпись к фото",null!=(t=e.caption)?t:""))?a:"";try{let t=await fetch("/api/weekly/caption",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({key:e.key,url:e.url,caption:l})}),a=await t.json().catch(()=>({}));if(k(a)&&a.ok)await w();else{let e=i(a)&&"string"==typeof a.error?a.error:t.statusText;alert("Не удалось сохранить подпись: ".concat(e))}}catch(e){alert(String(e))}}(0,n.useEffect)(()=>{(async()=>{p(!0),y(null);try{let e=await fetch(x,{cache:"no-store"}),t=await e.json(),a=c(t);0===a.length&&o&&o!==s&&(e=await fetch(g,{cache:"no-store"}),t=await e.json(),a=c(t)),u({ok:!0,items:a})}catch(e){y(String(e))}finally{p(!1)}})(),(async()=>{try{var e;let t=await fetch("/api/photo/can-upload",{cache:"no-store"}),a=await t.json(),l=i(a)?a:{};m(!!(null!=(e=l.canUpload)?e:l.ok))}catch(e){m(!1)}})()},[x,g,o,s]);let[N,v]=(0,n.useState)(null),S=r&&"items"in r&&r.items||[];return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold",children:o}),d&&(0,l.jsx)("div",{className:"text-white/70",children:"Загружаем изображения…"}),!d&&h&&(0,l.jsxs)("div",{className:"text-red-400",children:["Ошибка: ",h]}),!d&&!h&&0===S.length&&(0,l.jsx)("div",{className:"text-white/70",children:"В папке пока пусто."}),!d&&!h&&S.length>0&&(0,l.jsx)("ul",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:S.map(e=>{var t,a;return(0,l.jsxs)("li",{className:"group relative",children:[(0,l.jsx)("img",{src:e.url,alt:null!=(t=e.caption)?t:e.key,className:"w-full h-40 object-cover rounded-lg cursor-zoom-in",onClick:()=>v(e)}),(0,l.jsx)("div",{className:"absolute bottom-2 left-2 right-2 text-xs text-white",children:(null!=(a=e.caption)?a:"").trim()&&(0,l.jsx)("span",{className:"px-1.5 py-1 bg-black/60 rounded",children:e.caption})}),f&&(0,l.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>b(e),className:"rounded-md bg-white/80 hover:bg-white text-black text-xs px-2 py-1",title:"Подпись",children:"Подпись"}),(0,l.jsx)("button",{onClick:()=>j(e),className:"rounded-md bg-red-500/80 hover:bg-red-500 text-white text-xs px-2 py-1",title:"Удалить",children:"Удалить"})]})]},e.key)})}),N&&(0,l.jsx)("div",{className:"fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4",onClick:()=>v(null),children:(0,l.jsxs)("div",{className:"max-w-5xl w-full",children:[(0,l.jsx)("img",{src:N.url,alt:null!=(t=N.caption)?t:N.key,className:"w-full h-auto rounded-lg"}),(null!=(a=N.caption)?a:"").trim()&&(0,l.jsx)("div",{className:"mt-2 text-white text-sm",children:N.caption})]})})]})}}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=6850)),_N_E=e.O()}]);